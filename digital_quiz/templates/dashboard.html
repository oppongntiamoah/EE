{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Decision-Making Quiz</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .step { display: none; }
    .step.active { display: block; }
  </style>
</head>
<body class="bg-light">
<div class="container mt-5">
  <div class="card shadow-lg p-4">
    <h2 class="mb-4">Decision-Making Quiz</h2>
    <form id="wizardForm" method="post">
      {% csrf_token %}

      <!-- Step 1: Gender -->
      <div class="step active">
        <h4>Step 1: Select Your Gender</h4>
        <div class="mb-3">
          <label class="form-label">Gender</label>
          <select class="form-select" name="gender" required>
            <option value="">-- Choose --</option>
            <option value="m">Male</option>
            <option value="f">Female</option>
          </select>
        </div>
        <button type="button" class="btn btn-primary next-btn">Next</button>
      </div>

      <!-- Steps for Questions -->
     <!-- Steps for Questions -->
    {% for question in questions %}
    <div class="step">
    <h4>Step {{ forloop.counter|add:1 }}: {{ question.text }}</h4>
    
    <!-- Timer Display -->
    <div class="alert alert-info">
        Time left: <span class="timer">30</span> seconds
    </div>

    <div class="form-check">
        <input class="form-check-input" type="radio" name="q{{ question.id }}" value="A" required>
        <label class="form-check-label">{{ question.option_a }}</label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="q{{ question.id }}" value="B">
        <label class="form-check-label">{{ question.option_b }}</label>
    </div>

    <!-- Hidden field to store actual time taken -->
    <input type="hidden" name="time_q{{ question.id }}" value="">

    <div class="mt-3">
        <button type="button" class="btn btn-secondary prev-btn">Previous</button>
        {% if forloop.last %}
        <button type="submit" class="btn btn-success">Submit</button>
        {% else %}
        <button type="button" class="btn btn-primary next-btn">Next</button>
        {% endif %}
    </div>
    </div>
    {% endfor %}

    </form>
  </div>
</div>

<script>
let currentStep = 0;
let steps = document.querySelectorAll(".step");
let startTime = Date.now();
let timerInterval = null;
let countdown = 30;

function showStep(n) {
  steps.forEach((step, i) => step.classList.toggle("active", i === n));
  startTime = Date.now();
  resetTimer();
}

function resetTimer() {
  clearInterval(timerInterval);
  countdown = 30;
  let timerDisplay = steps[currentStep].querySelector(".timer");
  if (timerDisplay) timerDisplay.textContent = countdown;

  timerInterval = setInterval(() => {
    countdown--;
    if (timerDisplay) timerDisplay.textContent = countdown;

    if (countdown <= 0) {
      clearInterval(timerInterval);
      autoSkip();
    }
  }, 1000);
}

function recordTime() {
  let elapsed = (Date.now() - startTime) / 1000;
  let hiddenInput = steps[currentStep].querySelector("input[type=hidden]");
  if (hiddenInput) hiddenInput.value = elapsed.toFixed(2);
}

function autoSkip() {
  recordTime();
  if (currentStep < steps.length - 1) {
    currentStep++;
    showStep(currentStep);
  } else {
    document.getElementById("wizardForm").submit();
  }
}

// Next button
document.querySelectorAll(".next-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    recordTime();
    if (currentStep < steps.length - 1) {
      currentStep++;
      showStep(currentStep);
    }
  });
});

// Previous button
document.querySelectorAll(".prev-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    if (currentStep > 0) {
      currentStep--;
      showStep(currentStep);
    }
  });
});

showStep(currentStep);
</script>

</body>
</html>
